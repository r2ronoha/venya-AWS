<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">

<!-- <link rel="icon" href="/static/favicon.ico"> -->

<title>VenYa Init</title>

<!-- Bootstrap core CSS -->
<link href="/static/css/bootstrap.min.css" rel="stylesheet">

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<link href="/static/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

<!-- Custom styles for this template -->
<!-- <link href="/static/css/signin.css" rel="stylesheet"> -->
<link href="/static/css/arturo.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="/static/js/ie8-responsive-file-warning.js"></script><![endif]-->
<!-- <script src="/static/js/ie-emulation-modes-warning.js"></script> -->

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- <script src="C:UsersarturoDocumentsR2ROVenYaNode_jsserverdb-testspecialist.js"></script> -->
</head>
<body>
<script type="text/javascript">
var urlParams = {};
var customerDetails = {};
var customerId;
var venya_server_ip = 192.168.99.100;
var venya_server_port = 8888;
//var emailFormat = new RegExp("^[^@]+@[^@]+\\.[^@]+$","g");
//var emailFormat = new RegExp("[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?","g");
var emailFormat = new RegExp("^\\w+([\\.-_]?\\w+)*@\\w+([\\.-_]?\\w+)*(\\.\\w{2,3})+$","g");
var usernameFormat = new RegExp("^\\w{8,}$","g");
var passwordFormat = new RegExp("^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}$","g");
var phoneFormat = new RegExp("^(\\+|00)?[0-9]+$","g");
var objectidFormat = new RegExp("^[0-9a-fA-F]{24}$");
var postcodeFormat = new RegExp("^\\w+([\\s-]*\\w*)?$");
//var postcodeFormat = new RegExp("^[0-9]+$");

var pages = {
	"signin": "signin.html",
	"home": "home.html",
	"register": "register.html",
	"settings": "settings.html",
	"changeSettings": "changeSettings.html",
	"settingsPages": {
		"email": "changeEmail.html",
		"password": "changePassword.html",
		"times": "changeTimes.html",
		"username": "changeUsername.html",
		"address": "changeAddress.html",
		"times": "chamgeTimes.html"
	},
	"webcreatecustomer" : "web_create_customer.html",
	"webnewappointment" : "web_new_appointment.html"
}
var booleanField = {0: 0, "0": "0", 1: 1, "1": "1"};

var languages = ["ENG","ESP","FRA","GER"];

var  parseUrl(callback) = function(){
	venya_server_ip = document.location.hostname; 
	//console.log("document.location.hostname = " + document.location.hostname);
	var params = document.location.search.replace(/^\?/,'').split('&');
	for (var i=0; i < params.length; i++) {
		var field = params[i].split('=')[0];
		var value = params[i].split('=')[1];
		urlParams[field] = value;
	}
	customerId = urlParams["id"];
	callback();
	//return venya_server_ip;
}

var  setHeader(headType,message) = function(){
	var header = document.createElement(headType);
	header.appendChild(document.createTextNode(unescape(message.toUpperCase())));
	document.body.appendChild(header);
}

var  goTo(page,params)  = function(){
	var target = "./" + page + "?";
	for (var param in params) {
		target += param + "=" + params[param] + "&";
	}
	location.href = target.replace(/[?&]$/,'');
}
/*
var  createDataTable() = function(){
	var table = document.createElement("table");
	for (var field in urlParams) {
		if (field != "action") {
			var row = document.createElement("tr");
			
			var fieldCell = document.createElement("td");
			fieldCell.appendChild(document.createTextNode(field));
			fieldCell.className = "field";
			row.appendChild(fieldCell);
			
			var valueCell = document.createElement("td");
			valueCell.appendChild(document.createTextNode(unescape(urlParams[field])));
			valueCell.className = "value";
			row.appendChild(valueCell);
			
			table.appendChild(row);
		}
	}
	document.body.appendChild(table);
}
*/
var  createDataTable(tableData) = function(){
	if ( tableData == null ) tableData = urlParams;
	var table = document.createElement("table");
	for (var field in tableData) {
		if (field != "action") {
			var row = document.createElement("tr");
			
			var fieldCell = document.createElement("td");
			fieldCell.appendChild(document.createTextNode(field));
			fieldCell.className = "field";
			row.appendChild(fieldCell);
			
			var valueCell = document.createElement("td");
			
			var value = tableData[field];
			if ( field == "address" ) {
				var myAddress = "";
				for ( var elt in value ) {
					myAddress += value[elt] + ", ";
				}
				value = myAddress.replace(/, $/,'');				
			}
			
			//valueCell.appendChild(document.createTextNode(unescape(tableData[field])));
			valueCell.appendChild(document.createTextNode(unescape(value)));
			valueCell.className = "value";
			row.appendChild(valueCell);
			
			table.appendChild(row);
		}
	}
	document.body.appendChild(table);
}

var  getCustomerDetails(action,id,callback)  = function(){
	venya_server_ip = document.location.hostname;
	var myUrl = "http://" + venya_server_ip + ":" + venya_server_port + "/getCustomer?action=" + action + "&id=" + id;
	var xhr = new XMLHttpRequest();
	xhr.open('GET',myUrl,true);
	xhr.send();
	xhr.onreadystatechange = processRequest;
	
	function processRequest(e) {
		if (xhr.readyState == 4) {
			if (xhr.status == 200) {
				console.log(xhr.responseText);
				var response = JSON.parse(xhr.responseText);
				for (var field in response) {
					if ( field != "status" ) {
						var value = response[field];
						if ( value == undefined ) value = "N/A";
						customerDetails[field] = response[field];
					}
				}
				callback();
			} else {
				var response = JSON.parse(xhr.responseText);
				var errorUrl = "./signin.html?status=" + response["status"] + "&errormessage=" + escape(response["errormessage"]);
				location.href=errorUrl;
			}
		}
	}
}

var  getCustomerFullDetails(action,id,callback)  = function(){
	venya_server_ip = document.location.hostname;
	var myUrl = "http://" + venya_server_ip + ":" + venya_server_port + "/getCustomer?action=" + action + "&id=" + id;
	var xhr = new XMLHttpRequest();
	xhr.open('GET',myUrl,true);
	xhr.send();
	xhr.onreadystatechange = processRequest;
	
	function processRequest(e) {
		if (xhr.readyState == 4) {
			if (xhr.status == 200) {
				console.log(xhr.responseText);
				var response = JSON.parse(xhr.responseText);
				for (var field in response) {
					if ( field != "status" ) {
						var value = response[field];
						if ( value == undefined ) value = "N/A";
						customerDetails[field] = response[field];
					}
				}
				callback();
			} else {
				var response = JSON.parse(xhr.responseText);
				var errorUrl = "./signin.html?status=" + response["status"] + "&errormessage=" + escape(response["errormessage"]);
				location.href=errorUrl;
			}
		}
	}
}
</script>


<script>
//serverip = '{{ serverip }}';
window.serverip = document.location.hostname;
window.serverport = '{{ serverport }}';
parseUrl();
if (urlParams["status"] == "ERROR") {
setHeader("h2",urlParams["errormessage"]);
}
</script>
<div class="container">

<div class="links">
<!-- <button class="btn btn-lg btn-primary btn-block" type="button" onclick="goToWeb("./signin.html")">I am a CUSTOMER</button>
<button class="btn btn-lg btn-primary btn-block" type="button" onclick="signin_check()">I am a PROVIDER</button> -->
<!-- <a href="javascript:goTo(pages.signin,{'serverip' : urlParams.serverip,'serverport' : urlParams.serverport})">I am a CUSTOMER</a></br>
<a href="javascript:goTo(pages.webcreatecustomer,{'serverip' : urlParams.serverip,'serverport' : urlParams.serverport})">I am a PROVIDER</a></br> -->
<a href="javascript:goTo(pages.signin,{'serverip' : serverip,'serverport' : serverport})">I am a CUSTOMER</a></br>
<a href="javascript:goTo(pages.webcreatecustomer,{'serverip' : serverip,'serverport' : serverport})">I am a PROVIDER</a></br>
</div>


<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="/static/js/ie10-viewport-bug-workaround.js"></script>
</body>
</html>
